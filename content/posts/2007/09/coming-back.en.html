---
title: "Coming back"
date: 2007-09-09T12:09:21+00:00
slug: coming-back
categories: [web-development]
tags: [coral-cdn,twiceler,htaccess,cuill,hotlinking,php]
---
<p>Those that usually visit my page (yes, there are such people) would notice that it had an irregular behavior being inaccessible the most of the time. It was due to two reasons:</p>

<ul>
	<li><p>The <a href="http://www.theadminzone.com/forums/showthread.php?t=37400">abusive frequency</a> of the new search engine <a href="http://www.cuill.com">Cuill</a> indexing web pages squeezing the bandwidth with 1,000 daily requests, most of them referring to inexistent <a href="http://en.wikipedia.org/wiki/URL">URLs</a> that seem to be randomly generated by the robot combining different URLs, until it gets my <a href="http://sdf-eu.org">hosting server</a> to block my web page because of exceeding the <a href="http://sdf-eu.org/over/">daily bandwidth</a>.</p></li>
	<li><p>The <a href="http://en.wikipedia.org/wiki/Hot-linking">hotlinking</a> of an image hosted in my web page as an <a href="http://en.wikipedia.org/wiki/Avatar_(icon)">avatar</a> by one user from one of the 75 <a href="http://www.alexa.com/site/ds/top_sites?ts_mode=lang&amp;lang=es">most visited web pages in Spanish</a> (and about 2.000 <a href="http://www.alexa.com/site/ds/top_sites?ts_mode=global&amp;lang=none">most visited web page in the world</a>), according to <a href="http://www.alexa.com">Alexa</a>. This causes that every time someone reads a thread from that forum in which that user posted, the image is downloaded from my web page milking my <a href="http://en.wikipedia.org/wiki/Bandwidth#Digital_systems">bandwidth</a>.</p></li>
</ul>

<p>To fix this I did the following:</p>

<ul>
	<li><p>Redirected my web page to <a href="http://www.coralcdn.org">Coral Content Distribution Network</a> <a href="http://en.wikipedia.org/wiki/Cache">cach√©</a>, so when yo visit my web page you will be redirected to that copy (this is why it's slower now, but at least it works) being the original web page hosted at <a href="http://sdf-eu.org">SDF-eu</a> the source of Coral CDN. IF you want to do the same with your web page, you must detect when your web page is being visited from Coral CDN to allow the access and otherwise redirect the visitor to the same URL adding <var>.nyud.net</var> at the end of the domain name. Using <a href="http://www.php.net">PHP</a>:</p>
<pre>
&lt;?php
  if (strpos($_SERVER["HTTP_USER_AGENT"], "CoralWebPrx") === false)
  {
    header("HTTP/1.1 302 Found");
    header("Location: " . $_SERVER["HTTP_HOST"] . ".nyud.net" . $_SERVER["REQUEST_URI"]);
    exit;
  }
?&gt;
</pre>
	<p>If you don't use PHP, you can do it with <var><a href="http://httpd.apache.org/docs/1.3/howto/htaccess.html">.htaccess</a></var>:</p>
<pre>
RewriteEngine on
RewriteCond %{HTTP_USER_AGENT}  !^CoralWebPrx*
RewriteRule ^(.*) http://%{HTTP_HOST}.nyud.net/$1  [P,L]
</pre>
</li>
<li><p>Block Cuill. Cuill is a search engine <a href="http://blogoscoped.com/forum/106841.html">founded by ex Googlers</a> that's not yet working and nowadays it only indexes web pages. Only known by those of us who had to suffer its robot indexing our web page, this is why I'm not interested in being <a href="http://en.wikipedia.org/wiki/DoS">DoS</a>ed by this crawler in order to be indexed in their search engine. To block <a href="http://www.janetsystems.co.uk/Articles/WebRobots/tabid/82/itemid/693/Default.aspx">Twiceler</a> -Cuill robot- with <a href="http://www.php.net">PHP</a>:</p>
<pre>
&lt;?php
  if (strpos($_SERVER["HTTP_USER_AGENT"], "Twiceler") !== false)
  {
    header("HTTP/1.1 403 Access denied");
    exit;
  }
?&gt;
</pre>
<p>With <var><a href="http://httpd.apache.org/docs/1.3/howto/htaccess.html">.htaccess</a></var></p>
<pre>
RewriteEngine on
RewriteCond %{HTTP_USER_AGENT} Twiceler
RewriteRule .* - [F,L]
</pre>
<p>If this search engine respected the most basic rules for search engines, it would be possible to block it using <var><a href="http://www.robotstxt.org">robots.txt</a></var>:</p>
<pre>
User-Agent: Twiceler
Disallow: /
</pre>
<p>But it seems that I must add to the list of Cuill misbehaviours the fact that it seems to not honor this protocol.</p>
</li>

<li><p>Block hotlinking. Hotlinking consists in linking an image or any other file from one page in another without consent consuming the first one's bandwidth. Is one of the most common, harmful and rejected bad practices. This is why I blocked it. Since now, you won't be able to link to any image hosted on my web page, but you will be able to use ethic hotlinking service <a href="http://imgred.com">ImgRed</a>, as I do.</p>
<pre>
RewriteEngine On

RewriteCond %{REQUEST_FILENAME} .*jpg$|.*gif$|.*png$ [NC]
RewriteCond %{HTTP_REFERER} !^$
# Allow my own web page
RewriteCond %{HTTP_REFERER} !h0m3r\.sdf-eu\.org [NC]
# Allow my own web page in Coral CDN
RewriteCond %{HTTP_REFERER} !h0m3r\.sdf-eu\.org\.nyud\.net [NC]
# Allow ImgRed.com
RewriteCond %{HTTP_REFERER} !imgred\.com [NC]
# Allow search engines
RewriteCond %{HTTP_REFERER} !google\. [NC]
RewriteCond %{HTTP_REFERER} !yahoo\. [NC]
# Allow Google cache
RewriteCond %{HTTP_REFERER} !search\?q=cache [NC]

RewriteRule (.*) /img/leech.png
</pre>
</li>
</ul>

<p>That's all, it may affect site performance (especially Coral CDN) but I have no choice as long as I have so limited bandwidth and some people reject minimum code of ethics. If you want me to move to a better server, then you should know <a href="https://en.chuso.net/contact/about">what's the utility of advertisements</a> ;-)</p>
